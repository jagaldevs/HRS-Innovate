<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Western Front Trenches â€” Interactive 3D History Diorama</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,600;0,700;1,300&family=Outfit:wght@200;300;400;500;600&display=swap');
:root{--pb:rgba(248,245,240,.97);--td:#1a1a2e;--tm:#3a3a50;--tl:#6a6a80;--ah:#a04020;--as:#2a8a5a;--aht:#8a6030;--am:#7a4a9a;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#0a0a08;color:#d8d0c0;font-family:'Outfit',sans-serif;overflow:hidden;height:100vh;width:100vw;cursor:grab;}
body:active{cursor:grabbing;}canvas{display:block;}
.intro-screen{position:fixed;inset:0;z-index:200;background:linear-gradient(135deg,#0a0808,#1a1208);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity 1.5s;}
.intro-screen.fade-out{opacity:0;pointer-events:none;}
.intro-screen .ico{font-size:72px;opacity:0;animation:iF 1.5s ease forwards .3s;}
.intro-screen h1{font-family:'Crimson Pro',serif;font-size:38px;font-weight:700;color:#c8a060;margin-top:20px;opacity:0;animation:iF 1.5s ease forwards .6s;text-align:center;line-height:1.2;}
.intro-screen .tag{font-size:11px;letter-spacing:6px;color:rgba(200,160,96,.25);margin-top:10px;text-transform:uppercase;opacity:0;animation:iF 1.5s ease forwards 1s;}
.intro-screen .eb{margin-top:40px;padding:16px 48px;background:rgba(200,160,96,.06);border:1px solid rgba(200,160,96,.2);color:#c8a060;font-family:'Outfit',sans-serif;font-size:12px;letter-spacing:6px;text-transform:uppercase;cursor:pointer;border-radius:30px;opacity:0;animation:iF 1.5s ease forwards 1.4s;transition:all .4s;}
.intro-screen .eb:hover{background:rgba(200,160,96,.1);transform:scale(1.05);}
@keyframes iF{to{opacity:1;}}
.hud-top{position:fixed;top:0;left:0;right:0;height:80px;background:linear-gradient(to bottom,rgba(10,10,8,.75),transparent);z-index:10;pointer-events:none;display:flex;align-items:flex-start;justify-content:space-between;padding:18px 28px;}
.hud-title h1{font-family:'Crimson Pro',serif;font-size:20px;font-weight:700;color:rgba(255,255,255,.9);letter-spacing:2px;text-transform:uppercase;text-shadow:0 1px 8px rgba(0,0,0,.5);}
.hud-title .sub{font-size:10px;letter-spacing:4px;text-transform:uppercase;color:rgba(255,255,255,.35);margin-top:2px;}
.hs{display:flex;gap:8px;pointer-events:auto;align-items:flex-start;}
.sp{padding:4px 12px;border-radius:16px;font-size:9px;font-weight:500;letter-spacing:2px;text-transform:uppercase;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.6);cursor:default;}
.sb-btn{padding:5px 14px;border-radius:16px;font-size:9px;font-weight:600;letter-spacing:2px;text-transform:uppercase;background:rgba(200,160,96,.12);border:1px solid rgba(200,160,96,.3);color:#c8a060;cursor:pointer;transition:all .3s;pointer-events:auto;}
.sb-btn:hover{background:rgba(200,160,96,.2);transform:scale(1.05);}
.hud-bottom{position:fixed;bottom:0;left:0;right:0;height:70px;background:linear-gradient(to top,rgba(10,10,8,.8),transparent);z-index:10;display:flex;align-items:flex-end;justify-content:center;padding-bottom:14px;gap:4px;flex-wrap:wrap;}
.pt{padding:6px 12px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:18px;font-size:9px;letter-spacing:1.5px;color:rgba(255,255,255,.5);cursor:pointer;transition:all .35s;text-transform:uppercase;white-space:nowrap;}
.pt:hover,.pt.active{background:rgba(255,255,255,.2);border-color:rgba(255,255,255,.6);color:#fff;transform:translateY(-2px);}
.pt .tn{font-family:'Crimson Pro',serif;font-weight:700;font-size:12px;margin-right:4px;}
.ch{position:fixed;bottom:78px;left:50%;transform:translateX(-50%);z-index:10;font-size:9px;letter-spacing:4px;text-transform:uppercase;color:rgba(255,255,255,.18);pointer-events:none;}
/* INFO PANEL */
.ip{position:fixed;right:-460px;top:0;width:440px;height:100vh;background:var(--pb);border-left:1px solid rgba(0,0,0,.06);z-index:50;transition:right .6s cubic-bezier(.22,1,.36,1);backdrop-filter:blur(30px);box-shadow:-30px 0 80px rgba(0,0,0,.2);overflow-y:auto;overflow-x:hidden;}
.ip.active{right:0;}
.ph{position:relative;padding:48px 34px 26px;background:linear-gradient(135deg,rgba(160,64,32,.05),transparent);border-bottom:1px solid rgba(0,0,0,.05);}
.pc{position:absolute;top:16px;right:16px;width:34px;height:34px;background:none;border:1px solid rgba(0,0,0,.1);color:#888;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .3s;}.pc:hover{border-color:#333;color:#333;}
.pn{font-family:'Crimson Pro',serif;font-size:68px;font-weight:700;color:rgba(0,0,0,.04);line-height:1;position:absolute;top:18px;left:34px;}
.ph h2{font-family:'Crimson Pro',serif;font-size:22px;font-weight:600;color:var(--td);line-height:1.2;position:relative;z-index:1;}
.ph .ps{font-size:14px;color:var(--tl);margin-top:4px;font-family:'Crimson Pro',serif;font-style:italic;}
.pcur{margin-top:10px;padding:6px 12px;background:rgba(160,64,32,.06);border-radius:4px;display:inline-block;}
.pcur code{font-size:11px;font-weight:600;letter-spacing:1px;color:var(--ah);font-family:'Outfit',sans-serif;}
.pcur span{font-size:11px;color:var(--tl);margin-left:6px;}
.psubs{display:flex;gap:5px;margin-top:12px;flex-wrap:wrap;}
.pst{padding:3px 10px;border-radius:12px;font-size:9px;font-weight:500;letter-spacing:1.5px;text-transform:uppercase;}
.pst.history{background:rgba(160,64,32,.08);color:var(--ah);}
.pst.health{background:rgba(42,138,90,.08);color:var(--as);}
.pst.science{background:rgba(42,106,154,.08);color:#2a6a9a;}
.pst.math{background:rgba(122,74,154,.08);color:var(--am);}
.pb{padding:24px 34px 40px;}
.pb p{font-family:'Crimson Pro',serif;font-size:16px;line-height:1.8;color:var(--tm);margin-bottom:14px;}
.ta{margin-top:18px;padding:16px 18px;background:rgba(160,64,32,.04);border-left:3px solid var(--ah);border-radius:0 6px 6px 0;}
.ta .lbl{font-size:10px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:var(--ah);margin-bottom:6px;}
.ta p{font-size:13px;line-height:1.7;color:#5a3020;margin:0;font-family:'Outfit',sans-serif;}
.psts{margin-top:20px;border-top:1px solid rgba(0,0,0,.05);padding-top:14px;}
.psts .st{font-size:10px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:var(--tl);margin-bottom:10px;}
.sr{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid rgba(0,0,0,.03);}
.sl{font-size:12px;color:var(--tl);letter-spacing:1px;}
.sv{font-family:'Crimson Pro',serif;font-size:16px;font-weight:600;color:var(--td);}
.vc{margin-top:18px;padding:16px 18px;background:rgba(138,96,48,.06);border-radius:6px;}
.vc .lbl{font-size:10px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:var(--aht);margin-bottom:8px;}
.vw{margin-bottom:6px;}.vw strong{font-family:'Crimson Pro',serif;font-size:15px;color:var(--td);}.vw span{font-size:12px;color:var(--tl);display:block;margin-top:1px;}
/* SIDEBAR (Daily Routine) */
.sidebar{position:fixed;left:-380px;top:0;width:360px;height:100vh;background:var(--pb);border-right:1px solid rgba(0,0,0,.06);z-index:50;transition:left .6s cubic-bezier(.22,1,.36,1);backdrop-filter:blur(30px);box-shadow:30px 0 80px rgba(0,0,0,.15);overflow-y:auto;}
.sidebar.active{left:0;}
.sidebar-header{padding:28px 24px 18px;border-bottom:1px solid rgba(0,0,0,.06);}
.sidebar-header h2{font-family:'Crimson Pro',serif;font-size:20px;font-weight:600;color:var(--td);}
.sidebar-header .sh-sub{font-size:11px;color:var(--tl);margin-top:4px;letter-spacing:2px;text-transform:uppercase;}
.sidebar-header .sh-close{position:absolute;top:16px;right:16px;width:30px;height:30px;background:none;border:1px solid rgba(0,0,0,.1);color:#888;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;}
.sidebar-body{padding:12px 24px 40px;}
.routine-row{display:flex;gap:14px;padding:14px 0;border-bottom:1px solid rgba(0,0,0,.04);}
.routine-time{font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--ah);min-width:65px;text-align:right;}
.routine-event{font-size:13px;font-weight:600;color:var(--td);letter-spacing:.5px;}
.routine-desc{font-size:11px;color:var(--tl);margin-top:3px;line-height:1.5;}
/* MARKERS */
.pm{position:absolute;pointer-events:auto;cursor:pointer;z-index:5;}
.md{width:20px;height:20px;border-radius:50%;background:radial-gradient(circle,#d08040,#a05020);border:2.5px solid rgba(255,255,255,.8);box-shadow:0 0 10px rgba(208,128,64,.4),0 2px 6px rgba(0,0,0,.3);animation:mp 3s ease-in-out infinite;position:relative;}
.mr{position:absolute;top:-7px;left:-7px;width:34px;height:34px;border-radius:50%;border:2px solid rgba(208,128,64,.3);animation:re 3s ease-in-out infinite;}
.mt{position:absolute;left:32px;top:50%;transform:translateY(-50%);white-space:nowrap;padding:5px 12px;background:rgba(248,245,240,.95);border:1px solid rgba(0,0,0,.08);border-radius:4px;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--td);opacity:0;transition:opacity .3s,transform .3s;transform:translateY(-50%) translateX(5px);pointer-events:none;box-shadow:0 2px 12px rgba(0,0,0,.15);}
.pm:hover .mt{opacity:1;transform:translateY(-50%) translateX(0);}
.pm:hover .md{transform:scale(1.3);transition:transform .3s;}
@keyframes mp{0%,100%{box-shadow:0 0 6px rgba(208,128,64,.2),0 2px 5px rgba(0,0,0,.2);}50%{box-shadow:0 0 16px rgba(208,128,64,.5),0 2px 8px rgba(0,0,0,.25);}}
@keyframes re{0%,100%{transform:scale(1);opacity:.4;}50%{transform:scale(1.5);opacity:0;}}
@media(max-width:768px){.ip{width:100%;right:-100%;}.sidebar{width:100%;left:-100%;}.hs{display:none;}.hud-bottom{gap:3px;}.pt{padding:5px 8px;font-size:8px;}}
</style>
</head>
<body>
<div class="intro-screen" id="intro">
<div class="ico">ðŸª–</div>
<h1>The Western Front<br><span style="font-size:22px;font-weight:300;color:rgba(200,160,96,.6);">A British Frontline Trench Â· 5:00 AM</span></h1>
<div class="tag">Stand-To-Arms Â· Australian Imperial Force Â· 1916</div>
<button class="eb" id="enterBtn">Enter the Trench</button>
</div>
<div class="hud-top" id="hudTop" style="opacity:0;transition:opacity 1s;">
<div class="hud-title"><h1>The Western Front â€” Stand-To-Arms</h1><div class="sub">AC v9 Â· Year 8â€“9 History / Health / Science / Maths</div></div>
<div class="hs"><div class="sp">History</div><div class="sp">Health</div><div class="sp">Science</div><div class="sp">Maths</div><button class="sb-btn" id="sidebarBtn">ðŸ“‹ Daily Routine</button></div>
</div>
<div class="ch" id="hint" style="opacity:0;transition:opacity 1s;">Drag to rotate Â· Scroll to zoom Â· Click markers or tabs to learn</div>
<div class="hud-bottom" id="hudBot" style="opacity:0;transition:opacity 1s;">
<div class="pt" data-p="0"><span class="tn">01</span>Stand-To</div>
<div class="pt" data-p="1"><span class="tn">02</span>Dug Out</div>
<div class="pt" data-p="2"><span class="tn">03</span>Duckboards</div>
<div class="pt" data-p="3"><span class="tn">04</span>No Man's Land</div>
<div class="pt" data-p="4"><span class="tn">05</span>Periscope</div>
<div class="pt" data-p="5"><span class="tn">06</span>Rations</div>
<div class="pt" data-p="6"><span class="tn">07</span>Sandbags</div>
</div>
<div class="ip" id="infoPanel"><div class="ph" id="panelH"></div><div class="pb" id="panelB"></div></div>
<div class="sidebar" id="sidebar">
<div class="sidebar-header"><button class="sh-close" onclick="document.getElementById('sidebar').classList.remove('active')">âœ•</button><h2>Daily Trench Routine</h2><div class="sh-sub">A Soldier's Day on the Western Front</div></div>
<div class="sidebar-body" id="sidebarBody"></div>
</div>
<div id="cc" style="position:fixed;inset:0;z-index:1;"></div>
<div id="ml" style="position:fixed;inset:0;z-index:5;pointer-events:none;"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// Content sourced exclusively from PPT_Life_in_the_Trenches.pptx and PPT_-_Trench_Design.pptx

const INFO_POINTS = [
  {
    id: 1,
    title: "Stand-To-Arms",
    subtitle: "The Daily Dawn Routine",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history"],
    pos: { x: -2, y: 4.5, z: -1 },
    paragraphs: [
      "Every morning at 5:00 AM, soldiers carried out 'Stand-to' â€” short for 'Stand-to-Arms' â€” meaning to be on high alert for enemy attack. This took place half an hour before daylight, as dawn was the most likely time for an enemy assault. Every soldier climbed onto the Fire Step with weapons ready and peered toward the enemy lines.",
      "At 5:30 AM, the Rum Ration was issued, followed by Stand-down half an hour after daylight at 6:00 AM. The same routine repeated at dusk â€” Stand-to at 5:00 PM, half an hour before dark, then Stand-down at 6:30 PM. There was a fear of attack by charging men, artillery fire and gas attack. However, attacks were not every day. Often times, very little happened."
    ],
    thinkAbout: "Using the daily routine schedule, write a short letter home to your family about your experiences from yesterday. Use what you have learned to be creative â€” describe what you see, hear, feel and smell at Stand-to.",
    stats: { "Stand-to (dawn)": "5:00 AM", "Rum ration": "5:30 AM", "Stand-down": "6:00 AM", "Evening Stand-to": "5:00 PM" },
    vocabulary: [
      { word: "Stand-to-Arms", def: "To be on high alert for enemy attack â€” carried out daily at dawn and dusk" },
      { word: "Fire Step", def: "A raised ledge cut into the front wall of the trench, allowing soldiers to see and fire over the parapet" },
      { word: "Rum Ration", def: "A small daily issue of rum distributed after Stand-to, intended to steady nerves and ward off cold" }
    ]
  },
  {
    id: 2,
    title: "The Dug Out",
    subtitle: "Shelter Carved into the Earth",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history"],
    pos: { x: 6, y: 2.5, z: 2 },
    paragraphs: [
      "The Dug Out was a sheltered area carved into the side of the trench wall, providing soldiers with basic protection from enemy fire and the elements. It was one of the key features labelled in the British Army trench diagram, alongside the fire step, parapet, parados, and duckboards.",
      "Conditions inside were awful and inhumane. Life in the trenches was rated by soldiers across categories including trench conditions, fears, food, duties, and rats â€” and conditions consistently ranked among the worst aspects. Soldiers slept in shifts when they could, but rest was difficult amid the constant threat of shelling and the cramped, infested environment."
    ],
    thinkAbout: "Looking at the trench cross-section, what advantages or disadvantages are there to this system of trenches? Think about the Dug Out specifically â€” how does its position in the trench wall help protect soldiers? What are its limitations?",
    stats: { "Location": "Carved into trench wall", "Purpose": "Shelter from fire & weather", "Conditions": "Awful and inhumane" },
    vocabulary: [
      { word: "Dug Out", def: "A roofed shelter dug into the wall of a trench, providing basic protection from shells and weather" },
      { word: "Inhumane", def: "Without compassion for misery or suffering; extremely cruel or harsh conditions" },
      { word: "Attrition", def: "Where both sides seek to gradually wear down the other by a series of small-scale actions" }
    ]
  },
  {
    id: 3,
    title: "Duck Boards",
    subtitle: "Walking Above the Mud",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history", "health"],
    pos: { x: 0, y: 1, z: 3 },
    paragraphs: [
      "Duck Boards were wooden plank walkways laid along the bottom of the trench to keep soldiers out of the mud and standing water. They were one of the key components identified in the British Army trench diagram, and maintaining them was part of the daily routine â€” after 8:00 AM, soldiers would clean themselves and weapons, and tidy the trench.",
      "When duckboards broke or were blasted apart, soldiers' feet would be submerged in thick mud and water for hours. Trench conditions and the state of soldiers' feet were among the areas rated as most difficult by soldiers. The constant wet, cold conditions made foot care a daily battle and trench maintenance an endless task."
    ],
    thinkAbout: "A duckboard is defined as a wooden plank walkway laid on the trench floor. Why was this such an important piece of equipment? Think about what would happen to soldiers without them, and why trench maintenance (scheduled after 8:00 AM daily) was so important.",
    stats: { "Material": "Wooden planks", "Location": "Trench floor", "Maintenance": "Daily after 8:00 AM", "Purpose": "Keep soldiers above mud/water" },
    vocabulary: [
      { word: "Duck Board", def: "Wooden plank walkways laid on the trench floor to keep soldiers above the mud and standing water" },
      { word: "Trench Maintenance", def: "Daily repair work including fixing walls, draining water, and replacing damaged duckboards" },
      { word: "Stalemate", def: "A situation when neither army is able to progress forward" }
    ]
  },
  {
    id: 4,
    title: "No Man's Land & Barbed Wire",
    subtitle: "The Killing Ground Between the Lines",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history"],
    pos: { x: -6, y: 3.5, z: -8 },
    paragraphs: [
      "Beyond the Parapet and the tangled Barbed Wire lay No Man's Land â€” the desolate ground between opposing trenches. Barbed wire was strung in dense belts in front of the trench as a key defensive feature, identified in the British Army trench diagram alongside the parapet, sandbags, and fire step.",
      "The failure of the German Schlieffen Plan in 1914 ended the war of movement and led to a stalemate â€” a situation when neither army is able to progress forward. Both sides dug a series of trenches opposite each other, and this was how the rest of the war was fought. This led to a war of attrition â€” where both sides seek to gradually wear down the other by a series of small-scale actions. The trenches stretched from the coast at Belgium in the north to the Swiss border, 700 km south-east. This area became known as the Western Front."
    ],
    thinkAbout: "What adjectives would you use to describe No Man's Land? Think about why attacking across this ground was so difficult. Can you identify at least 2 reasons why attacking trenches was difficult, based on what you can see in the model?",
    stats: { "Western Front": "~700 km long", "From": "Belgian coast", "To": "Swiss border", "Cause": "Failure of Schlieffen Plan" },
    vocabulary: [
      { word: "No Man's Land", def: "The dangerous ground between opposing front-line trenches" },
      { word: "Barbed Wire", def: "Wire with sharp points strung in front of trenches to slow enemy attacks" },
      { word: "Western Front", def: "The area of major fighting in Western Europe which moved only a little during four years of war" }
    ]
  },
  {
    id: 5,
    title: "The Periscope",
    subtitle: "Seeing Without Being Seen",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history", "science"],
    pos: { x: -5, y: 5.5, z: -3 },
    paragraphs: [
      "The Periscope was a key piece of trench equipment identified in the British Army trench diagram. It allowed soldiers to observe No Man's Land and enemy positions without exposing their head above the parapet â€” where they would be vulnerable to enemy fire.",
      "There was a constant fear of attack by charging men, artillery fire and gas attack. The periscope helped soldiers carry out their observation duties during Stand-to and throughout the day while staying safely below the sandbag line. It used two angled mirrors to reflect the view from above the parapet down to the soldier's eye level."
    ],
    thinkAbout: "The periscope uses two mirrors angled at 45Â° to redirect light. Why was this piece of equipment so important given what you know about the threats soldiers faced? Draw a diagram showing how it works and explain why soldiers couldn't simply look over the top.",
    stats: { "Type": "Mirror-based optical device", "Position": "Mounted above parapet", "Purpose": "Safe observation", "Threats": "Snipers, artillery, gas" },
    vocabulary: [
      { word: "Periscope", def: "An optical instrument using angled mirrors to allow observation from a concealed position below the parapet" },
      { word: "Parapet", def: "The front wall of the trench, built from sandbags, providing cover from enemy fire" },
      { word: "Artillery", def: "Large-calibre guns used to fire shells over long distances â€” a constant threat in the trenches" }
    ]
  },
  {
    id: 6,
    title: "Rations & Daily Life",
    subtitle: "Food, Rats & the Daily Routine",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history"],
    pos: { x: 3, y: 2, z: 4 },
    paragraphs: [
      "Breakfast at 7:00 AM was usually bacon and tea. Dinner was served at noon, and tea at 5:00 PM. After dinner, soldiers had some time for sleep and downtime, though rest was constantly disrupted. From 6:30 PM onwards, soldiers would work all night with some time for rest â€” being on patrol, digging trenches, and getting stores and supplies.",
      "Rats were a constant plague in the trenches, rated alongside trench conditions, food, fears, shell shock, and duties as among the worst aspects of trench life. When asked to rate how difficult life was out of 5 â€” from 'Not Too Bad' to 'Awful and Inhumane' â€” soldiers consistently rated rats and trench conditions at the worst end of the scale."
    ],
    thinkAbout: "You have been given some free time at the Front Line. Write a short letter to your family about your experiences from yesterday. Use the daily routine schedule and what you have learned to be creative.",
    stats: { "Breakfast": "7:00 AM (bacon & tea)", "Dinner": "12:00 PM", "Tea": "5:00 PM", "Night work": "6:30 PM onwards" },
    vocabulary: [
      { word: "Rations", def: "The food and drink supplied to soldiers â€” typically basic and monotonous at the front line" },
      { word: "Shell Shock", def: "A condition caused by prolonged exposure to bombardment and the stresses of trench warfare" },
      { word: "Duties", def: "The daily tasks soldiers were required to perform including patrols, digging, and maintenance" }
    ]
  },
  {
    id: 7,
    title: "Sandbags & Trench Design",
    subtitle: "Built to the British Army Manual",
    ac: "AC9HS8K07",
    acd: "Explain the significance of events and developments from a range of perspectives",
    subj: ["history", "math"],
    pos: { x: -3, y: 4, z: -5 },
    paragraphs: [
      "Trenches were constructed according to the British Army Manual. A trench is an area dug into the ground which is deeper than it is wide, used by soldiers for protection against the enemy in the field. The key defensive features were the Parapet (front wall) reinforced with Sandbags, and the Parados (rear wall). The Ammunition Shelf stored weapons and supplies within reach.",
      "However, in reality, a trench would look very different from the neat diagrams. The trenches stretched 700 km from Belgium to Switzerland, and maintaining them was an enormous task. After 8:00 AM each day, soldiers would clean themselves and weapons, and tidy the trench. Despite this constant maintenance, conditions remained extremely difficult throughout the war."
    ],
    thinkAbout: "Compare the British Army Manual diagram of a trench to what a real trench looked like. What adjectives would you use to describe the difference? What advantages or disadvantages are there to this system of trenches?",
    stats: { "Design": "British Army Manual", "Front wall": "Parapet with sandbags", "Rear wall": "Parados", "Length": "700 km (Western Front)" },
    vocabulary: [
      { word: "Parapet", def: "The front wall of a trench, built from sandbags and earth, providing cover from enemy fire" },
      { word: "Parados", def: "The rear wall of a trench, protecting soldiers from behind" },
      { word: "Ammunition Shelf", def: "A shelf built into the trench wall for storing weapons, ammunition and supplies within reach" }
    ]
  }
];

const DAILY_ROUTINE = [
  { time: "5:00 AM", event: "Stand-to", desc: "'Stand-to-Arms' â€” on high alert for enemy attack, half an hour before daylight" },
  { time: "5:30 AM", event: "Rum Ration", desc: "Rum ration issued to soldiers after Stand-to" },
  { time: "6:00 AM", event: "Stand-down", desc: "Stand-down half an hour after daylight" },
  { time: "7:00 AM", event: "Breakfast", desc: "Usually bacon and tea" },
  { time: "After 8:00 AM", event: "Maintenance & Cleaning", desc: "Clean themselves and weapons, tidy trench" },
  { time: "12:00 PM", event: "Dinner", desc: "Midday meal served" },
  { time: "After Dinner", event: "Sleep & Downtime", desc: "Rest period â€” though constantly disrupted" },
  { time: "5:00 PM", event: "Tea", desc: "Afternoon meal" },
  { time: "5:00 PM", event: "Evening Stand-to", desc: "Stand-to half an hour before dusk" },
  { time: "6:30 PM", event: "Stand-down", desc: "Stand-down half an hour after dusk" },
  { time: "6:30 PM+", event: "Night Duties", desc: "Work all night â€” on patrol, digging trenches, getting stores/supplies, with some time for rest" }
];

// === THREE.JS SCENE â€” BRIGHTENED ===
const CC=document.getElementById('cc'),S=new THREE.Scene();
// Overcast dawn sky â€” lighter, more visible
const skyG=new THREE.SphereGeometry(200,32,16);
const skyC=new Float32Array(skyG.attributes.position.count*3);
for(let i=0;i<skyG.attributes.position.count;i++){
  const y=skyG.attributes.position.getY(i)/200;
  const t=Math.max(0,y);
  // Brighter overcast dawn: grey-blue with warm horizon
  skyC[i*3]=.32+t*.15+(1-t)*.18;
  skyC[i*3+1]=.32+t*.18+(1-t)*.14;
  skyC[i*3+2]=.38+t*.22+(1-t)*.1;
}
skyG.setAttribute('color',new THREE.BufferAttribute(skyC,3));
S.add(new THREE.Mesh(skyG,new THREE.MeshBasicMaterial({vertexColors:true,side:THREE.BackSide})));
S.fog=new THREE.FogExp2(0x404848,.008);
const cam=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,.1,500);
const R=new THREE.WebGLRenderer({antialias:true});
R.setSize(innerWidth,innerHeight);R.setPixelRatio(Math.min(devicePixelRatio,2));
R.shadowMap.enabled=true;R.shadowMap.type=THREE.PCFSoftShadowMap;
R.toneMapping=THREE.ACESFilmicToneMapping;R.toneMappingExposure=1.4;
CC.appendChild(R.domElement);

// BRIGHTER LIGHTING
S.add(new THREE.AmbientLight(0x808898,.7));
// Overcast sky light
const skyLight=new THREE.DirectionalLight(0x8898b0,.6);skyLight.position.set(0,30,0);S.add(skyLight);
// Dawn directional
const dawn=new THREE.DirectionalLight(0xffc880,.5);dawn.position.set(-15,12,-20);dawn.castShadow=true;
dawn.shadow.mapSize.set(2048,2048);dawn.shadow.camera.left=-30;dawn.shadow.camera.right=30;dawn.shadow.camera.top=30;dawn.shadow.camera.bottom=-30;
S.add(dawn);
// Fill from other side
const fill=new THREE.DirectionalLight(0x7888a0,.35);fill.position.set(15,10,10);S.add(fill);
// Warm horizon glow
const horizGlow=new THREE.PointLight(0xff8040,.4,60);horizGlow.position.set(0,3,-40);S.add(horizGlow);
// Hemisphere for overall lift
S.add(new THREE.HemisphereLight(0x8090b0,0x605840,.5));

// Oil lamp in dugout (flickering but brighter)
const lamp=new THREE.PointLight(0xff9040,1.0,14);lamp.position.set(6.5,2.2,2);lamp.castShadow=true;S.add(lamp);
const lampBulb=new THREE.Mesh(new THREE.SphereGeometry(.1,6,4),new THREE.MeshBasicMaterial({color:0xffbb50}));
lampBulb.position.copy(lamp.position);S.add(lampBulb);

// Materials â€” brighter, more visible
const mudM=new THREE.MeshStandardMaterial({color:0x5a4428,roughness:.95,metalness:0});
const mudW=new THREE.MeshStandardMaterial({color:0x4a3418,roughness:.9});
const woodM=new THREE.MeshStandardMaterial({color:0x6a4a28,roughness:.82});
const woodLt=new THREE.MeshStandardMaterial({color:0x7a5a30,roughness:.78});
const sandM=new THREE.MeshStandardMaterial({color:0x8a7a58,roughness:.85});
const sandDk=new THREE.MeshStandardMaterial({color:0x7a6a48,roughness:.88});
const metalM=new THREE.MeshStandardMaterial({color:0x606068,roughness:.45,metalness:.4});
const waterM=new THREE.MeshPhysicalMaterial({color:0x3a3a28,roughness:.1,metalness:.1,transparent:true,opacity:.45,clearcoat:.6});
const wireM=new THREE.MeshStandardMaterial({color:0x505058,roughness:.55,metalness:.5});
const clothKhaki=new THREE.MeshStandardMaterial({color:0x6a6848,roughness:.82});
const skinM=new THREE.MeshStandardMaterial({color:0xb08868,roughness:.7});

// === TERRAIN ===
const tG=new THREE.PlaneGeometry(80,80,100,100);tG.rotateX(-Math.PI/2);
const tP=tG.attributes.position;
for(let i=0;i<tP.count;i++){
  const x=tP.getX(i),z=tP.getZ(i);
  let y=0;
  y+=Math.sin(x*.08)*.8+Math.cos(z*.06)*.6+Math.sin(x*.2+z*.15)*.25;
  // Shell craters in No Man's Land (z<-5)
  if(z<-5){for(let c=0;c<10;c++){const cx=-18+c*4+(c%2)*2,cz=-8-c*2.5;const d=Math.sqrt((x-cx)**2+(z-cz)**2);if(d<3)y-=Math.max(0,(3-d)*.6);}}
  // Trench cut
  if(x>-9&&x<9&&z>-3&&z<7){const eX=Math.min(x+9,9-x),eZ=Math.min(z+3,7-z),e=Math.min(eX,eZ);y-=3.5*Math.min(1,e*.5);}
  tP.setY(i,y);
}
tG.computeVertexNormals();
const tC=new Float32Array(tP.count*3);
for(let i=0;i<tP.count;i++){
  const z=tP.getZ(i);let r,g,b;
  if(z<-5){r=.28;g=.22;b=.15;} else{r=.3+Math.random()*.04;g=.24+Math.random()*.03;b=.15+Math.random()*.02;}
  const n=.85+Math.random()*.15;tC[i*3]=r*n;tC[i*3+1]=g*n;tC[i*3+2]=b*n;
}
tG.setAttribute('color',new THREE.BufferAttribute(tC,3));
const terrain=new THREE.Mesh(tG,new THREE.MeshStandardMaterial({vertexColors:true,roughness:.95}));
terrain.receiveShadow=true;S.add(terrain);

// === TRENCH WALLS ===
const TG=new THREE.Group();
const fWall=new THREE.Mesh(new THREE.BoxGeometry(18,4.5,.8),mudW);fWall.position.set(0,.2,-2.6);fWall.castShadow=true;TG.add(fWall);
const rWall=new THREE.Mesh(new THREE.BoxGeometry(18,4,.8),mudW);rWall.position.set(0,.2,6.6);rWall.castShadow=true;TG.add(rWall);
for(let sx of[-9,9]){const w=new THREE.Mesh(new THREE.BoxGeometry(.8,4.5,10),mudW);w.position.set(sx,.2,2);w.castShadow=true;TG.add(w);}

// Timber revetment
for(let rx=-7;rx<=7;rx+=2){
  const fR=new THREE.Mesh(new THREE.BoxGeometry(.14,3.5,.14),woodM);fR.position.set(rx,-.2,-2.15);fR.castShadow=true;TG.add(fR);
  const fH=new THREE.Mesh(new THREE.BoxGeometry(.12,.1,1),woodM);fH.position.set(rx,.8,-2.2);TG.add(fH);
  const rR=new THREE.Mesh(new THREE.BoxGeometry(.14,3,.14),woodM);rR.position.set(rx,-.3,6.15);TG.add(rR);
  // Horizontal planking on walls
  for(let hy of[-.5,.5,1.5]){
    const hp=new THREE.Mesh(new THREE.BoxGeometry(1.8,.12,.06),woodLt);hp.position.set(rx,hy,-2.18);TG.add(hp);
  }
}
// Cross braces
for(let rx=-6;rx<=6;rx+=3){const b=new THREE.Mesh(new THREE.BoxGeometry(.08,2.5,.08),woodM);b.position.set(rx,.5,-2.2);b.rotation.z=.3;TG.add(b);}

// === FIRE STEP ===
const fireStep=new THREE.Mesh(new THREE.BoxGeometry(14,.7,1.5),woodLt);
fireStep.position.set(-1,.85,-1.5);fireStep.castShadow=true;fireStep.receiveShadow=true;TG.add(fireStep);
for(let p=0;p<7;p++){
  const pl=new THREE.Mesh(new THREE.BoxGeometry(1.8,.08,1.4),new THREE.MeshStandardMaterial({color:0x6a5030+Math.floor(Math.random()*0x0a0808),roughness:.8}));
  pl.position.set(-5+p*1.9,.92,-1.5);TG.add(pl);
}

// === PARAPET (CylinderGeometry sandbags as specified) ===
function sandbagRow(startX,y,z,count,rotY){
  for(let i=0;i<count;i++){
    const sb=new THREE.Mesh(new THREE.CylinderGeometry(.18,.2,.38,8).rotateZ(Math.PI/2),i%2===0?sandM:sandDk);
    sb.position.set(startX+i*.42,y,z);sb.rotation.y=rotY+(Math.random()-.5)*.15;sb.rotation.x=(Math.random()-.5)*.1;sb.castShadow=true;TG.add(sb);
  }
}
for(let row=0;row<3;row++){sandbagRow(-7+(row%2===0?0:.21),2.5+row*.35,-2.8,32,.02);}
// Parados
for(let row=0;row<2;row++){sandbagRow(-7+(row%2===0?0:.21),2.2+row*.35,6.8,32,.02);}

// === DUCKBOARDS (BoxGeometry as specified) ===
for(let dx=-7;dx<=7;dx+=1.2){
  const broken=Math.random()>.82;
  const db=new THREE.Mesh(new THREE.BoxGeometry(1,.1,3.5),woodLt);
  db.position.set(dx,-1.4+(broken?-.3:0)+(Math.random()-.1)*.08,2);
  if(broken){db.rotation.z=(Math.random()-.5)*.4;db.rotation.x=(Math.random()-.5)*.2;}
  db.castShadow=true;db.receiveShadow=true;TG.add(db);
}
for(let rz=-1;rz<=5;rz+=2.5){const r=new THREE.Mesh(new THREE.BoxGeometry(15,.12,.15),woodM);r.position.set(0,-1.35,rz);TG.add(r);}
// Water pooling
const poolG=new THREE.PlaneGeometry(16,5,20,8);poolG.rotateX(-Math.PI/2);
const poolP=poolG.attributes.position;for(let i=0;i<poolP.count;i++)poolP.setY(i,-1.35+Math.sin(poolP.getX(i)*.3)*.02);
const pool=new THREE.Mesh(poolG,waterM);pool.position.set(0,0,2);TG.add(pool);

// === DUG OUT ===
const dugout=new THREE.Group();
const dF1=new THREE.Mesh(new THREE.BoxGeometry(.2,2.8,.2),woodM);dF1.position.set(4.8,.4,5.8);dugout.add(dF1);
const dF2=new THREE.Mesh(new THREE.BoxGeometry(.2,2.8,.2),woodM);dF2.position.set(7.8,.4,5.8);dugout.add(dF2);
const dL=new THREE.Mesh(new THREE.BoxGeometry(3.2,.22,.3),woodM);dL.position.set(6.3,1.9,5.8);dugout.add(dL);
const dInt=new THREE.Mesh(new THREE.BoxGeometry(3.5,2.5,3),new THREE.MeshStandardMaterial({color:0x2a1a10,roughness:1}));
dInt.position.set(6.3,.3,7.8);dugout.add(dInt);
for(let rb=0;rb<4;rb++){const bm=new THREE.Mesh(new THREE.BoxGeometry(3.3,.15,.18),woodM);bm.position.set(6.3,1.7,6.2+rb*.5);dugout.add(bm);}
const lPost=new THREE.Mesh(new THREE.CylinderGeometry(.02,.02,.5,4),metalM);lPost.position.set(6.5,2,6.8);dugout.add(lPost);
const lBody=new THREE.Mesh(new THREE.CylinderGeometry(.08,.06,.2,8),metalM);lBody.position.set(6.5,1.7,6.8);dugout.add(lBody);
TG.add(dugout);

// === PERISCOPE ===
const periG=new THREE.Group();
const periT=new THREE.Mesh(new THREE.CylinderGeometry(.06,.06,2.5,8),metalM);periT.position.set(-5,3,-2);periG.add(periT);
const periTop=new THREE.Mesh(new THREE.BoxGeometry(.2,.15,.15),metalM);periTop.position.set(-5,4.2,-2);periG.add(periTop);
const mirr=new THREE.Mesh(new THREE.PlaneGeometry(.12,.1),new THREE.MeshPhysicalMaterial({color:0x90a0b0,roughness:.05,metalness:.8,clearcoat:1}));
mirr.position.set(-5,4.22,-1.92);mirr.rotation.x=-.4;periG.add(mirr);
TG.add(periG);

// === AMMUNITION SHELF ===
const shG=new THREE.Group();
const shB=new THREE.Mesh(new THREE.BoxGeometry(2,.08,.5),woodM);shB.position.set(-3,1.5,-2.1);shG.add(shB);
const shBr1=new THREE.Mesh(new THREE.BoxGeometry(.08,.6,.08),woodM);shBr1.position.set(-4,1.2,-2.1);shG.add(shBr1);
const shBr2=new THREE.Mesh(new THREE.BoxGeometry(.08,.6,.08),woodM);shBr2.position.set(-2,1.2,-2.1);shG.add(shBr2);
for(let ab=0;ab<3;ab++){
  const bx=new THREE.Mesh(new THREE.BoxGeometry(.5,.3,.35),new THREE.MeshStandardMaterial({color:0x4a4a28,roughness:.78}));
  bx.position.set(-3.8+ab*.7,1.7,-2.1);bx.rotation.y=(Math.random()-.5)*.2;shG.add(bx);
}
TG.add(shG);

// === BARBED WIRE ===
for(let wx=-8;wx<=8;wx+=3){
  const post=new THREE.Mesh(new THREE.CylinderGeometry(.05,.06,2,6),woodM);
  post.position.set(wx,1.5,-6);post.rotation.z=(Math.random()-.5)*.15;post.castShadow=true;TG.add(post);
  for(let strand=0;strand<3;strand++){
    const pts=[];for(let t=0;t<=1;t+=.05)pts.push(new THREE.Vector3(wx+Math.sin(t*Math.PI*8)*.3,.8+strand*.4+Math.sin(t*Math.PI*4)*.08,-5.5-t*3));
    const c=new THREE.CatmullRomCurve3(pts);TG.add(new THREE.Mesh(new THREE.TubeGeometry(c,24,.015,4,false),wireM));
  }
}
for(let tw=0;tw<30;tw++){
  const pts=[],bx=(Math.random()-.5)*16,bz=-5-Math.random()*5;
  for(let t=0;t<=1;t+=.1)pts.push(new THREE.Vector3(bx+Math.sin(t*6)*1,1+Math.sin(t*4)*.5+Math.random()*.2,bz+t*2));
  TG.add(new THREE.Mesh(new THREE.TubeGeometry(new THREE.CatmullRomCurve3(pts),12,.01,3,false),wireM));
}

// === AIF SOLDIERS on Fire Step ===
function soldier(x,z,action){
  const g=new THREE.Group();
  for(let lx of[-.15,.15]){const leg=new THREE.Mesh(new THREE.CylinderGeometry(.08,.07,.9,6),clothKhaki);leg.position.set(lx,-.05,0);g.add(leg);}
  for(let lx of[-.15,.15]){const bt=new THREE.Mesh(new THREE.BoxGeometry(.16,.15,.25),new THREE.MeshStandardMaterial({color:0x3a2210,roughness:.85}));bt.position.set(lx,-.55,.03);g.add(bt);}
  const torso=new THREE.Mesh(new THREE.BoxGeometry(.45,.65,.3),clothKhaki);torso.position.set(0,.65,0);g.add(torso);
  // Webbing/straps
  for(let wx of[-.1,.1]){const w=new THREE.Mesh(new THREE.BoxGeometry(.06,.6,.32),new THREE.MeshStandardMaterial({color:0x6a6038,roughness:.78}));w.position.set(wx,.65,0);g.add(w);}
  const head=new THREE.Mesh(new THREE.SphereGeometry(.14,8,6),skinM);head.position.set(0,1.15,0);g.add(head);
  // Slouch hat (Australian)
  const brim=new THREE.Mesh(new THREE.CylinderGeometry(.22,.24,.04,12),clothKhaki);brim.position.set(0,1.3,0);g.add(brim);
  const crown=new THREE.Mesh(new THREE.CylinderGeometry(.12,.15,.15,8),clothKhaki);crown.position.set(0,1.38,0);g.add(crown);
  // Left brim turned up
  const bu=new THREE.Mesh(new THREE.BoxGeometry(.08,.12,.05),clothKhaki);bu.position.set(-.2,1.35,0);bu.rotation.z=.4;g.add(bu);
  
  if(action==='rifle'){
    const rifle=new THREE.Mesh(new THREE.CylinderGeometry(.02,.025,1.3,6),woodM);rifle.position.set(.3,.5,-.05);rifle.rotation.z=-.15;g.add(rifle);
    const barrel=new THREE.Mesh(new THREE.CylinderGeometry(.012,.012,.6,4),metalM);barrel.position.set(.35,1.1,-.08);g.add(barrel);
  } else if(action==='rum'){
    const cup=new THREE.Mesh(new THREE.CylinderGeometry(.04,.035,.06,8),metalM);cup.position.set(.25,.8,.1);g.add(cup);
  } else {
    const arm=new THREE.Mesh(new THREE.CylinderGeometry(.04,.035,.45,5),clothKhaki);arm.position.set(.25,.85,-.15);arm.rotation.x=-.5;g.add(arm);
  }
  g.position.set(x,1.2,z);return g;
}
const s1=soldier(-3,-1.3,'peering');s1.rotation.y=Math.PI;TG.add(s1);
const s2=soldier(-1,-1.3,'rifle');s2.rotation.y=Math.PI+.15;TG.add(s2);
const s3=soldier(1,-1.3,'rum');s3.rotation.y=Math.PI-.1;TG.add(s3);

// === SCATTER: tins, mugs, rats ===
for(let i=0;i<8;i++){
  const tin=new THREE.Mesh(new THREE.CylinderGeometry(.06,.06,.08,8),metalM);
  tin.position.set(-4+Math.random()*10,-1.3+Math.random()*.1,1+Math.random()*4);
  tin.rotation.set(Math.random()*Math.PI,(Math.random()-.5)*2,Math.random()*Math.PI);TG.add(tin);
}
for(let i=0;i<4;i++){
  const mug=new THREE.Mesh(new THREE.CylinderGeometry(.04,.035,.07,8),new THREE.MeshStandardMaterial({color:0x9a8a68,roughness:.6}));
  mug.position.set(-2+Math.random()*6,-1.3,1.5+Math.random()*3);mug.rotation.x=Math.random()>.5?Math.PI/2:0;TG.add(mug);
}
function rat(x,y,z){
  const rg=new THREE.Group();
  const body=new THREE.Mesh(new THREE.SphereGeometry(.08,6,4),new THREE.MeshStandardMaterial({color:0x4a3828,roughness:.9}));
  body.scale.set(1,.7,1.5);rg.add(body);
  const hd=new THREE.Mesh(new THREE.SphereGeometry(.04,5,4),new THREE.MeshStandardMaterial({color:0x4a3828,roughness:.9}));
  hd.position.set(0,.02,.12);rg.add(hd);
  const tp=[new THREE.Vector3(0,0,-.12),new THREE.Vector3(.02,.02,-.22),new THREE.Vector3(-.01,.01,-.35)];
  rg.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints(tp),new THREE.LineBasicMaterial({color:0x5a4838})));
  rg.position.set(x,y,z);rg.rotation.y=Math.random()*Math.PI*2;return rg;
}
TG.add(rat(4,-1.3,3.5));TG.add(rat(5.5,-1.3,4));TG.add(rat(-1,-1.3,4.5));TG.add(rat(3,-1.28,2));TG.add(rat(6,-1.25,3));

// === TRENCH SIGN (labelling) ===
const signPost=new THREE.Mesh(new THREE.BoxGeometry(.08,1.5,.08),woodM);signPost.position.set(8,.5,3);TG.add(signPost);
const signBoard=new THREE.Mesh(new THREE.BoxGeometry(1.2,.4,.05),woodLt);signBoard.position.set(8,1.3,3);TG.add(signBoard);

S.add(TG);

// === RAIN ===
const rainN=1500,rainG=new THREE.BufferGeometry(),rainP=new Float32Array(rainN*3),rainV=new Float32Array(rainN);
for(let i=0;i<rainN;i++){rainP[i*3]=(Math.random()-.5)*50;rainP[i*3+1]=Math.random()*25;rainP[i*3+2]=(Math.random()-.5)*50;rainV[i]=.12+Math.random()*.12;}
rainG.setAttribute('position',new THREE.BufferAttribute(rainP,3));
const rain=new THREE.Points(rainG,new THREE.PointsMaterial({color:0x8898b0,size:.04,transparent:true,opacity:.35,sizeAttenuation:true}));S.add(rain);

// === MIST ===
const mistN=400,mistG=new THREE.BufferGeometry(),mistP=new Float32Array(mistN*3);
for(let i=0;i<mistN;i++){mistP[i*3]=(Math.random()-.5)*60;mistP[i*3+1]=Math.random()*5;mistP[i*3+2]=(Math.random()-.5)*60;}
mistG.setAttribute('position',new THREE.BufferAttribute(mistP,3));
const mist=new THREE.Points(mistG,new THREE.PointsMaterial({color:0x708088,size:.6,transparent:true,opacity:.1,sizeAttenuation:true}));S.add(mist);

// === CAMERA ===
let drag=false,pv={x:0,y:0},sph={t:Math.PI*.6,p:Math.PI/3.5,r:22};
function uC(){cam.position.set(sph.r*Math.sin(sph.p)*Math.sin(sph.t),sph.r*Math.cos(sph.p),sph.r*Math.sin(sph.p)*Math.cos(sph.t));cam.lookAt(0,1,0);}uC();
R.domElement.addEventListener('mousedown',e=>{drag=true;pv={x:e.clientX,y:e.clientY};});
R.domElement.addEventListener('mousemove',e=>{if(!drag)return;sph.t-=(e.clientX-pv.x)*.005;sph.p=Math.max(.2,Math.min(Math.PI/2.1,sph.p+(e.clientY-pv.y)*.005));pv={x:e.clientX,y:e.clientY};uC();});
R.domElement.addEventListener('mouseup',()=>drag=false);R.domElement.addEventListener('mouseleave',()=>drag=false);
R.domElement.addEventListener('wheel',e=>{sph.r=Math.max(8,Math.min(50,sph.r+e.deltaY*.03));uC();});
R.domElement.addEventListener('touchstart',e=>{if(e.touches.length===1){drag=true;pv={x:e.touches[0].clientX,y:e.touches[0].clientY};}});
R.domElement.addEventListener('touchmove',e=>{if(!drag||e.touches.length!==1)return;e.preventDefault();sph.t-=(e.touches[0].clientX-pv.x)*.005;sph.p=Math.max(.2,Math.min(Math.PI/2.1,sph.p+(e.touches[0].clientY-pv.y)*.005));pv={x:e.touches[0].clientX,y:e.touches[0].clientY};uC();},{passive:false});
R.domElement.addEventListener('touchend',()=>drag=false);

// === MARKERS ===
const mL=document.getElementById('ml');
const mE=INFO_POINTS.map(pt=>{const el=document.createElement('div');el.className='pm';el.innerHTML='<div class="md"><div class="mr"></div></div><div class="mt">'+pt.title+'</div>';el.addEventListener('click',()=>oP(pt));mL.appendChild(el);return{el,pt};});
function uM(){mE.forEach(({el,pt})=>{const v=new THREE.Vector3(pt.pos.x,pt.pos.y,pt.pos.z).project(cam);if(v.z>1){el.style.display='none';return;}el.style.display='block';el.style.transform='translate('+(((v.x*.5+.5)*innerWidth-11))+'px,'+((-v.y*.5+.5)*innerHeight-11)+'px)';});}

// === PANEL ===
function oP(pt){
  const sbs=pt.subj.map(s=>{const l={history:'History',health:'Health/PE',science:'Science',math:'Maths'};return'<span class="pst '+s+'">'+l[s]+'</span>';}).join('');
  document.getElementById('panelH').innerHTML='<button class="pc" onclick="cP()">âœ•</button><div class="pn">0'+pt.id+'</div><h2>'+pt.title+'</h2><div class="ps">'+pt.subtitle+'</div><div class="pcur"><code>'+pt.ac+'</code><span>â€” '+pt.acd+'</span></div><div class="psubs">'+sbs+'</div>';
  const ps=pt.paragraphs.map(p=>'<p>'+p+'</p>').join(''),sts=Object.entries(pt.stats).map(([k,v])=>'<div class="sr"><span class="sl">'+k+'</span><span class="sv">'+v+'</span></div>').join(''),voc=pt.vocabulary.map(v=>'<div class="vw"><strong>'+v.word+'</strong><span>'+v.def+'</span></div>').join('');
  document.getElementById('panelB').innerHTML=ps+'<div class="ta"><div class="lbl">ðŸª– Think, Write &amp; Investigate</div><p>'+pt.thinkAbout+'</p></div><div class="psts"><div class="st">By the Numbers</div>'+sts+'</div><div class="vc"><div class="lbl">ðŸ“– Key Vocabulary</div>'+voc+'</div>';
  document.getElementById('infoPanel').classList.add('active');
  document.querySelectorAll('.pt').forEach(t=>t.classList.remove('active'));
  const tab=document.querySelector('.pt[data-p="'+(pt.id-1)+'"]');if(tab)tab.classList.add('active');
  document.getElementById('sidebar').classList.remove('active');
}
function cP(){document.getElementById('infoPanel').classList.remove('active');document.querySelectorAll('.pt').forEach(t=>t.classList.remove('active'));}
document.querySelectorAll('.pt').forEach(tab=>{tab.addEventListener('click',()=>oP(INFO_POINTS[parseInt(tab.dataset.p)]));});

// === SIDEBAR ===
document.getElementById('sidebarBtn').addEventListener('click',()=>{
  document.getElementById('sidebar').classList.toggle('active');
  document.getElementById('infoPanel').classList.remove('active');
});
document.getElementById('sidebarBody').innerHTML=DAILY_ROUTINE.map(r=>'<div class="routine-row"><div class="routine-time">'+r.time+'</div><div class="routine-info"><div class="routine-event">'+r.event+'</div><div class="routine-desc">'+r.desc+'</div></div></div>').join('');

// ENTER
document.getElementById('enterBtn').addEventListener('click',()=>{document.getElementById('intro').classList.add('fade-out');setTimeout(()=>{document.getElementById('intro').style.display='none';document.getElementById('hudTop').style.opacity='1';document.getElementById('hudBot').style.opacity='1';document.getElementById('hint').style.opacity='1';},600);});

// === ANIMATE ===
let time=0;
function anim(){
  requestAnimationFrame(anim);time+=.008;
  const rp=rain.geometry.attributes.position;
  for(let i=0;i<rp.count;i++){let y=rp.getY(i)-rainV[i];if(y<-2){y=25;rp.setX(i,(Math.random()-.5)*50);rp.setZ(i,(Math.random()-.5)*50);}rp.setY(i,y);rp.setX(i,rp.getX(i)+.004);}
  rp.needsUpdate=true;
  const mp=mist.geometry.attributes.position;
  for(let i=0;i<mp.count;i++){let x=mp.getX(i)+.005;if(x>30)x=-30;mp.setX(i,x);mp.setY(i,mp.getY(i)+Math.sin(time*.2+i*.05)*.003);}
  mp.needsUpdate=true;
  lamp.intensity=.9+Math.sin(time*10)*.2+Math.sin(time*17)*.1+Math.random()*.06;
  lampBulb.scale.setScalar(.85+Math.sin(time*12)*.15);
  horizGlow.intensity=.35+Math.sin(time*.5)*.05;
  const wp=pool.geometry.attributes.position;
  for(let i=0;i<wp.count;i++)wp.setY(i,-1.35+Math.sin(wp.getX(i)*.5+time*2)*.01);
  wp.needsUpdate=true;
  uM();R.render(S,cam);
}
anim();
addEventListener('resize',()=>{cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();R.setSize(innerWidth,innerHeight);});

</script>
</body>
</html>